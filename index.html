<!DOCTYPE html>
<html lang="no">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Repetert lesing ‚Äì Alt-i-ett (v6 lyn-bonus)</title>
  <style>
    :root{ --blue:#1e88e5;--green:#22c55e;--red:#ef4444;--gold:#f59e0b;--bg:#f5f7fb;--card:#ffffff;--muted:#6b7280; }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:var(--bg);color:#111}
    header{background:linear-gradient(135deg,#1e88e5, #60a5fa);color:#fff;padding:18px 16px}
    header h1{margin:0;font-size:clamp(20px,3.2vw,28px)}

    /* Top stats bar */
    .statsbar{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:10px;margin-top:12px}
    .stat{background:rgba(255,255,255,.15);backdrop-filter:blur(4px);border-radius:12px;padding:10px 12px;display:flex;align-items:center;justify-content:space-between}
    .stat .label{opacity:.95}
    .stat .value{font-weight:800;font-size:20px}

    /* Layout */
    .main{display:grid;grid-template-columns:2fr 1fr;gap:18px;max-width:1200px;margin:18px auto;padding:0 16px}
    @media (max-width: 980px){ .main{grid-template-columns:1fr} }

    /* Left column */
    .panel{background:var(--card);border:1px solid #e5e7eb;border-radius:14px;box-shadow:0 8px 22px rgba(0,0,0,.05)}
    .panel .hd{padding:12px 14px;border-bottom:1px solid #eef2f7;display:flex;gap:8px;align-items:center}
    .panel .bd{padding:14px}

    textarea#inputText{width:100%;min-height:110px;resize:vertical;border:1px solid #e5e7eb;border-radius:10px;padding:10px}
    .btn{appearance:none;border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer;transition:transform .05s ease,opacity .15s}
    .btn:hover{transform:translateY(-1px)}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .btn.pri{background:var(--blue);color:#fff}
    .btn.sec{background:#eef2f7;color:#111}
    .btn.gold{background:var(--gold);color:#1f2a37}
    .btn.green{background:var(--green);color:#03210f}

    /* Word area */
    #wordDisplay{background:#fff;padding:18px 16px;border-radius:14px;border:1px solid #e7e7e7;box-shadow:0 6px 18px rgba(0,0,0,.06);font-size:22px;line-height:2;}
    #wordDisplay .word{display:inline-block;margin:4px 6px;padding:6px 10px;border:1.5px solid #cfd6e4;border-radius:10px;background:#fff;cursor:pointer;user-select:none;transition:transform .05s,background .15s,outline .15s}
    #wordDisplay .word:hover{transform:scale(1.03)}
    .word.error{background:#ffe3e3;border-color:#e08b8b;box-shadow:inset 0 0 0 2px #ffc2c2}
    .word.last{background:#d1fae5;border-color:#34d399;outline:3px solid #86efac}
    .word.prev{background:#e0f2fe;border-color:#38bdf8;box-shadow:0 0 0 3px rgba(56,189,248,.25) inset; position:relative}
    .word.prev::after{content:'forrige'; position:absolute; top:-12px; right:-6px; font-size:10px; background:#0ea5e9; color:#fff; padding:2px 6px; border-radius:6px}
    .word.beyond{opacity:.28}

    .inline-stats{color:var(--muted);margin-top:8px;font-size:14px}

    /* Right column: timers & slot */
    .kpi{background:#fff;border:1px solid #e5e7eb;border-radius:12px;box-shadow:0 6px 16px rgba(0,0,0,.06);padding:12px}
    .kpi h3{margin:0 0 6px;font-size:16px}
    .timerBox{display:flex;flex-direction:column;align-items:center;gap:8px}
    .time{font-size:42px;font-weight:800}
    .controls{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
    .quick{display:flex;gap:6px}

    .progress{height:12px;background:#ecf0f5;border-radius:6px;overflow:hidden}
    .progress .bar{height:100%;background:var(--blue);width:0}

    /* Results table */
    .results{max-width:1200px;margin:10px auto 40px;padding:0 16px}
    table{width:100%;border-collapse:collapse;background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 6px 16px rgba(0,0,0,.05)}
    thead th{background:#f9fafb;text-align:left}
    th,td{padding:10px 12px;border-bottom:1px solid #eef2f7;font-size:14px}
    tbody tr:hover{background:#fcfcfc}

    /* Modal base */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:10000}
    .modal.active{display:flex}
    .modal .card{background:#fff;border-radius:14px;border:1px solid #e5e7eb;min-width:320px;max-width:92vw;padding:18px;box-shadow:0 14px 30px rgba(0,0,0,.25);text-align:center}

    /* Slot machine */
    .reels{display:flex;gap:12px;justify-content:center;margin:14px 0}
    .reel{font-size:48px;border:1px solid #e5e7eb;border-radius:10px;width:70px;height:70px;display:flex;align-items:center;justify-content:center}

    /* Start overlay 3-2-1-LES */
    #startOverlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.78);color:#fff;font-size:min(18vw,140px);font-weight:900;letter-spacing:2px;z-index:11000}

    /* Flashcards modal */
    #flashModal .wordbig{font-size:min(10vw,64px);font-weight:800;margin:10px 0}
    #flashModal .sub{color:var(--muted);margin-bottom:10px}

    /* Post-round bar */
    #postRoundBar{display:none;margin-top:8px;padding:8px 10px;border:1px dashed #94a3b8;border-radius:10px;background:#f8fafc;color:#334155;align-items:center;gap:8px}
    #postRoundBar .hint{font-size:12px;color:#475569}
  </style>
</head>
<body>
  <header>
    <h1>üìñ Repetert lesing</h1>
    <div class="statsbar">
      <div class="stat"><span class="label">üí∞ Mynter</span><span class="value" id="coinsTotal">0</span></div>
      <div class="stat"><span class="label">üíé Diamanter</span><span class="value" id="diamonds">0/10</span></div>
      <div class="stat"><span class="label">üèÜ Rekord (K-OPM)</span><span class="value" id="bestWPM">0</span></div>
      <div class="stat"><span class="label">‚ö° Bonus</span><span class="value" id="lightningTotal">0</span></div>
      <div class="stat"><span class="label">üìä Omgang</span><span class="value" id="roundCounter">0</span></div>
    </div>
  </header>

  <div class="main">
    <!-- Left: text input + display -->
    <div class="panel">
      <div class="hd">
        <textarea id="inputText" placeholder="Lim inn avsnitt her‚Ä¶"></textarea>
        <button class="btn pri" id="prepareBtn">Klargj√∏r tekst</button>
        <button class="btn sec" id="resetRoundBtn">Nullstill omgang</button>
      </div>
      <div class="bd">
        <div id="wordDisplay"></div>
        <div class="inline-stats">
          Ord totalt: <b id="totalWords">0</b> ¬∑ Feil (telt): <b id="mistakeCount">0</b> ¬∑ Korrekte (telt): <b id="correctCount">0</b>
        </div>
        <div id="postRoundBar">
          <span class="hint">‚è∞ Tiden er ute ‚Äì marker feilord og klikk p√• <b>siste ord</b>. Deretter ¬´Avslutt omgang¬ª.</span>
          <button class="btn green" id="finishBtn" style="margin-left:auto">Avslutt omgang</button>
        </div>
      </div>
    </div>

    <!-- Right: timers & slot -->
    <div class="stack" style="display:flex;flex-direction:column;gap:12px">
      <div class="kpi">
        <h3>Stoppeklokke</h3>
        <div class="timerBox">
          <div id="swTime" class="time">00:00</div>
          <div class="controls">
            <button class="btn pri" id="swStart">Start</button>
            <button class="btn sec" id="swStop">Stopp</button>
            <button class="btn sec" id="swReset">Nullstill</button>
          </div>
        </div>
      </div>
      <div class="kpi">
        <h3>Nedtelling</h3>
        <div class="timerBox">
          <div class="quick">
            <button class="btn sec" id="q10">10s</button>
            <button class="btn sec" id="q30">30s</button>
            <button class="btn sec" id="q60">1m</button>
          </div>
          <div id="cdTime" class="time">01:00</div>
          <div class="controls">
            <button class="btn pri" id="cdStart">Start</button>
            <button class="btn sec" id="cdPause">Pause</button>
            <button class="btn sec" id="cdReset">Nullstill</button>
          </div>
        </div>
      </div>
      <div class="kpi">
        <h3>Premiesporing</h3>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;align-items:center">
          <div>
            <div>Diamanter</div>
            <div class="progress"><div id="diamondBar" class="bar"></div></div>
          </div>
          <div style="text-align:right">
            <button class="btn gold" id="openSlotBtn" style="display:none">√Öpne spilleautomat</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <section class="results">
    <h2 style="margin:10px 0">Resultater</h2>
    <table>
      <thead><tr>
        <th>#</th><th>Dato/tid</th><th>Tid (s)</th><th>Ord</th><th>Feil (/min)</th><th>Korrekte (/min)</th><th>K-OPM</th><th>Mynter</th>
      </tr></thead>
      <tbody id="resultsBody"></tbody>
    </table>
  </section>

  <!-- Start overlay 3-2-1-LES! -->
  <div id="startOverlay">3</div>

  <!-- Slot modal -->
  <div id="slotModal" class="modal" aria-modal="true" role="dialog">
    <div class="card">
      <h3>Spilleautomat</h3>
      <div class="reels"><div id="reel1" class="reel">üçí</div><div id="reel2" class="reel">üçã</div><div id="reel3" class="reel">üîî</div></div>
      <div id="slotMsg">Trykk Spinn</div>
      <div style="margin-top:10px;display:flex;gap:8px;justify-content:center">
        <button class="btn gold" id="slotSpin">Spinn</button>
        <button class="btn sec" id="slotClose">Lukk</button>
      </div>
    </div>
  </div>

  <!-- Flashcards modal -->
  <div id="flashModal" class="modal" aria-modal="true" role="dialog">
    <div class="card">
      <div class="sub" id="flashProg">Ord 1 av 1</div>
      <div class="wordbig" id="flashWord">ord</div>
      <div style="display:flex;gap:8px;justify-content:center;margin-top:8px">
        <button class="btn pri" id="flashNext">Neste ord</button>
        <button class="btn sec" id="flashDone">Ferdig</button>
      </div>
    </div>
  </div>

  <script>
  // Helpers
  const $ = id => document.getElementById(id);
  const fmt = t => { const m = String(Math.floor(t/60)).padStart(2,'0'); const s = String(t%60).padStart(2,'0'); return `${m}:${s}`; };

  // Storage
  const KEY = 'rl_full_app_v6_lyn';
  const def = { rounds: [], coins: 0, bestWPM: 0, diamonds: 0, wordBank: [], roundCount: 0, prevLastIdx: null, lastMistakes: [], lightning: 0 };
  let S = load();
  function load(){ try{ return JSON.parse(localStorage.getItem(KEY)) || {...def}; }catch{ return {...def}; } }
  function save(){ localStorage.setItem(KEY, JSON.stringify(S)); }

  // State
  let words = []; let lastIdx = null; let mistakes = new Set();
  let swInt=null, swSec=0, swRunning=false, swPreparing=false;
  let cdInt=null, cdLeft=60, cdInit=60, cdRunning=false, cdPreparing=false;
  let finishedThisRound=false; // timer finished flag
  let spinsLeftRound = 0; // maks 3 etter hver runde

  // UI init
  updateTop();
  rebuildResults();
  updateDiamondBar();

  // Prepare text
  $('prepareBtn').onclick = () => {
    const t = $('inputText').value.trim();
    if(!t){ alert('Lim inn tekst f√∏rst.'); return; }
    words = t.split(/\s+/).filter(Boolean);
    renderWords();
    clearMarks();
    updateCounts();
    applyPrevMarker();
    hidePostRoundBar();
  };
  $('resetRoundBtn').onclick = () => { clearMarks(); updateCounts(); applyPrevMarker(); hidePostRoundBar(); };

  function renderWords(){
    const w = $('wordDisplay'); w.innerHTML='';
    words.forEach((word,i)=>{
      const span=document.createElement('span');
      span.textContent=word; span.className='word';
      // Klikk under lesing = FEIL, dobbeltklikk = SISTE ORD
      span.onclick=()=>onWordClick(i, span);
      span.ondblclick=()=>{ setLast(i); };
      w.appendChild(span); w.append(' ');
    });
    $('totalWords').textContent = words.length;
  }

  function applyPrevMarker(){
    document.querySelectorAll('#wordDisplay .word').forEach(n=>n.classList.remove('prev'));
    if(S.prevLastIdx==null) return;
    const idx = Math.min(S.prevLastIdx, words.length-1);
    if(idx>=0){ const nodes=document.querySelectorAll('#wordDisplay .word'); if(nodes[idx]) nodes[idx].classList.add('prev'); }
  }

  function clearMarks(){
    mistakes.clear(); lastIdx=null; finishedThisRound=false;
    document.querySelectorAll('#wordDisplay .word').forEach(n=>{ n.classList.remove('error','last','beyond'); });
  }

  function showPostRoundBar(){ $('postRoundBar').style.display='flex'; }
  function hidePostRoundBar(){ $('postRoundBar').style.display='none'; }

  // Click logic
  function onWordClick(i, el){
    const isTimerActive = (swRunning || cdRunning || swPreparing || cdPreparing);

    if(isTimerActive){
      // Under aktiv timer: klikk = marker FEIL (dobbelklikk setter siste ord)
      toggleError(i, el);
      return;
    }

    if(finishedThisRound){
      // Etter timer ferdig: marker feil fritt; klikk p√• siste ord for √• avslutte.
      if(lastIdx === null){
        setLast(i);
        return;
      }
      if(i === lastIdx){
        finalizeAuto();
        return;
      }
      toggleError(i, el);
      return;
    }

    // Ingen timer aktiv: toggler feil
    toggleError(i, el);
  }

  function toggleError(i, el){
    if(el.classList.contains('error')){ el.classList.remove('error'); mistakes.delete(i); }
    else { el.classList.add('error'); mistakes.add(i); }
    updateCounts();
  }

  function setLast(i){
    document.querySelectorAll('#wordDisplay .word.last').forEach(n=>n.classList.remove('last'));
    lastIdx = i; const nodes = document.querySelectorAll('#wordDisplay .word');
    if(nodes[i]) nodes[i].classList.add('last');
    nodes.forEach((n,idx)=>{ n.classList.toggle('beyond', lastIdx!==null && idx>lastIdx); });
    updateCounts();
  }

  function counted(){
    const total = lastIdx===null?0:(lastIdx+1);
    let err=0; mistakes.forEach(idx=>{ if(lastIdx!==null && idx<=lastIdx) err++; });
    return { total, err, corr: Math.max(0, total-err) };
  }

  function updateCounts(){
    const {total, err, corr} = counted();
    $('mistakeCount').textContent = err;
    $('correctCount').textContent = corr;
  }

  // Timers: common prep overlay 3-2-1-LES
  function showOverlayStep(txt){ const ov=$('startOverlay'); ov.style.display='flex'; ov.textContent=txt; }
  function hideOverlay(){ $('startOverlay').style.display='none'; }

  // Stopwatch
  $('swStart').onclick = ()=>{
    if(swRunning || swPreparing) return; swPreparing=true; $('swStart').disabled=true;
    clearMarks(); hidePostRoundBar();
    let c=3; showOverlayStep(c);
    const prep=setInterval(()=>{
      c--; if(c>0) showOverlayStep(c); else if(c===0) showOverlayStep('LES!'); else { clearInterval(prep); hideOverlay(); startSW(); }
    },1000);
    function startSW(){ swPreparing=false; $('swStart').disabled=false; swRunning=true; swSec=0; $('swTime').textContent=fmt(swSec); swInt=setInterval(()=>{ swSec++; $('swTime').textContent=fmt(swSec); },1000); }
  };
  $('swStop').onclick = ()=>{ if(!swRunning) return; clearInterval(swInt); swRunning=false; finishedThisRound=true; alert('‚è∞ Stoppeklokka stoppet. Marker feilord og klikk siste ord.'); showPostRoundBar(); };
  $('swReset').onclick = ()=>{ if(swRunning) { clearInterval(swInt); swRunning=false; } swSec=0; $('swTime').textContent='00:00'; };

  // Countdown
  function setCountdown(s){ cdInit=s; cdLeft=s; $('cdTime').textContent=fmt(cdLeft); }
  $('q10').onclick=()=>setCountdown(10);
  $('q30').onclick=()=>setCountdown(30);
  $('q60').onclick=()=>setCountdown(60);
  setCountdown(60);

  $('cdStart').onclick = () =>{
    if(cdRunning || cdPreparing) return; cdPreparing=true; $('cdStart').disabled=true;
    clearMarks(); hidePostRoundBar();
    let c=3; showOverlayStep(c);
    const prep=setInterval(()=>{
      c--; if(c>0) showOverlayStep(c); else if(c===0) showOverlayStep('LES!'); else { clearInterval(prep); hideOverlay(); startCD(); }
    },1000);
    function startCD(){ cdPreparing=false; $('cdStart').disabled=false; cdRunning=true; $('cdTime').textContent=fmt(cdLeft); cdInt=setInterval(()=>{
      if(cdLeft>0){ cdLeft--; $('cdTime').textContent=fmt(cdLeft); }
      if(cdLeft<=0){ clearInterval(cdInt); cdRunning=false; finishedThisRound=true; alert('‚è∞ Tiden er ute. Marker feilord og klikk siste ord.'); showPostRoundBar(); }
    },1000); }
  };
  $('cdPause').onclick = ()=>{ if(!cdRunning) return; clearInterval(cdInt); cdRunning=false; };
  $('cdReset').onclick = ()=>{ if(cdRunning){ clearInterval(cdInt); cdRunning=false; } setCountdown(cdInit||60); };

  // Manuell avslutning-knapp
  $('finishBtn').onclick = ()=>{ if(lastIdx==null){ alert('Klikk p√• siste ord f√∏rst.'); return; } finalizeAuto(); };

  // Finalize
  function finalizeAuto(){
    const timeSec = swSec>0 ? swSec : (cdInit - cdLeft);
    if(timeSec<=0){ alert('Start en av klokkene for √• m√•le tid.'); return; }
    const {total, err, corr} = counted();
    if(total<=0){ alert('Marker siste leste ord.'); return; }

    const prevBest = S.bestWPM || 0;
    const wpm = Math.round((corr*60)/timeSec);
    const fpm = Math.round((err*60)/timeSec);
    const cpm = Math.round((corr*60)/timeSec);

    const coins = (wpm >= prevBest) ? 10 : 3; // behold som f√∏r (>= gir 10)
    S.coins = (S.coins||0) + coins;

    // ‚ö° Lyn-bonus KUN ved ny rekord (strengt >)
    if(wpm > prevBest){ S.lightning = (S.lightning||0) + 1; }

    S.bestWPM = Math.max(prevBest, wpm);
    S.roundCount = (S.roundCount||0)+1;

    // Lagre sist-mark√∏r for neste runde
    S.prevLastIdx = lastIdx;

    // "Siste omgang"-feilord (kun denne omgang)
    const roundMistakes = [];
    mistakes.forEach(i=>{ if(i<=lastIdx){ const w=words[i]; if(w && !roundMistakes.includes(w)) roundMistakes.push(w); } });
    S.lastMistakes = roundMistakes;
    roundMistakes.forEach(w=>{ if(!S.wordBank.includes(w)) S.wordBank.push(w); });

    // lagre omgang
    S.rounds.push({ ts: Date.now(), timeSec, total, errors: err, correct: corr, wpm, coins, lastIdx, fpm, cpm });
    save();

    // UI
    updateTop(); updateDiamondBar(); rebuildResults();

    // Spilleautomat etter hver omgang (opptil 3 sjanser)
    spinsLeftRound = 3;
    openSlotAutomatically();

    // Flashcards for kun siste omgang ‚Äî vis etter 2 sek
    if((S.lastMistakes||[]).length>0){ setTimeout(()=>openFlashcards(), 2000); }

    // Reset for ny omgang (behold prev-mark√∏r)
    finishedThisRound=false; lastIdx=null;
    document.querySelectorAll('#wordDisplay .word').forEach(n=>n.classList.remove('error','last','beyond'));
    mistakes.clear();
    updateCounts();
    applyPrevMarker();
    hidePostRoundBar();
  }

  function updateTop(){
    $('coinsTotal').textContent=S.coins||0;
    $('bestWPM').textContent=S.bestWPM||0;
    $('diamonds').textContent=`${S.diamonds||0}/10`;
    $('roundCounter').textContent=S.roundCount||0;
    $('lightningTotal').textContent=S.lightning||0;
  }
  function updateDiamondBar(){ const pct=((S.diamonds||0)/10)*100; $('diamondBar').style.width=pct+'%'; }

  function rebuildResults(){
    const tb=$('resultsBody'); tb.innerHTML='';
    S.rounds.forEach((r,i)=>{
      const tr=document.createElement('tr');
      const dt=new Date(r.ts).toLocaleString(undefined,{hour12:false});
      tr.innerHTML=`<td>${i+1}</td><td>${dt}</td><td>${r.timeSec}</td><td>${r.total}</td><td>${r.errors} (${r.fpm}/min)</td><td>${r.correct} (${r.cpm}/min)</td><td><b>${r.wpm}</b></td><td>${r.coins}</td>`;
      tb.appendChild(tr);
    });
  }

  // Slot Machine (max 3 spins per round)
  const symbols=['üçí','üçã','üîî','‚≠ê','7Ô∏è‚É£','üçÄ'];
  function updateSpinUI(){
    const btn=$('slotSpin');
    btn.textContent = spinsLeftRound>0 ? `Spinn (${spinsLeftRound} igjen)` : 'Ingen sjanser igjen';
    btn.disabled = spinsLeftRound<=0;
    $('openSlotBtn').style.display = spinsLeftRound>0 ? 'inline-block' : 'none';
  }
  function openSlotAutomatically(){ $('openSlotBtn').style.display='inline-block'; openSlot(); updateSpinUI(); }
  function openSlot(){ $('slotModal').classList.add('active'); $('slotMsg').textContent='Trykk Spinn'; updateSpinUI(); }
  function closeSlot(){ $('slotModal').classList.remove('active'); }
  $('openSlotBtn').onclick=()=>{ openSlot(); };
  $('slotClose').onclick=()=> closeSlot();
  $('slotSpin').onclick=()=>{
    if(spinsLeftRound<=0) return;
    $('slotMsg').textContent='Snurrer‚Ä¶';
    const r1=$('reel1'),r2=$('reel2'),r3=$('reel3');
    let t=0; const spin=setInterval(()=>{
      r1.textContent=symbols[Math.floor(Math.random()*symbols.length)];
      r2.textContent=symbols[Math.floor(Math.random()*symbols.length)];
      r3.textContent=symbols[Math.floor(Math.random()*symbols.length)];
      if(++t>12){ clearInterval(spin); finish(); }
    },90);
    function finish(){
      const win=Math.random()<0.30;
      if(win){ r1.textContent='üíé'; r2.textContent='üíé'; r3.textContent='üíé'; $('slotMsg').textContent='JACKPOT! Du vant en diamant!'; S.diamonds=(S.diamonds||0)+1; if(S.diamonds>=10){ alert('üéÅ 10 diamanter! Premie fra l√¶reren!'); S.diamonds=0; } save(); updateTop(); updateDiamondBar(); }
      else { r1.textContent='‚ùå'; r2.textContent='‚ùå'; r3.textContent='‚ùå'; $('slotMsg').textContent='Ingen jackpot denne gangen.'; }
      spinsLeftRound = Math.max(0, spinsLeftRound-1);
      updateSpinUI();
    }
  };

  // Flashcards (kun siste omgang)
  function getFlashList(){ return Array.isArray(S.lastMistakes) ? [...S.lastMistakes] : []; }
  function openFlashcards(){
    const list=getFlashList(); if(list.length===0) return;
    let idx=0; $('flashModal').classList.add('active');
    function render(){ $('flashWord').textContent=list[idx]; $('flashProg').textContent=`Ord ${idx+1} av ${list.length}`; }
    render();
    $('flashNext').onclick=()=>{ idx=(idx+1)%list.length; render(); };
    $('flashDone').onclick=()=>{ $('flashModal').classList.remove('active'); };
  }

  // Expose for debugging
  window._S=S;
  </script>
</body>
</html>
